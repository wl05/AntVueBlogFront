(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5252"],{Aa6a:function(e,t,a){"use strict";var r=a("iOob");a.n(r).a},Ztr3:function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"c",function(){return i}),a.d(t,"b",function(){return o}),a.d(t,"d",function(){return s});var r=a("t3Un");function n(e){return r.a.post("/categories",{name:e})}function i(){return r.a.get("/categories")}function o(e){return r.a.delete("/categories/"+e)}function s(e,t){return r.a.put("/categories/"+e,{name:t})}},gCAA:function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"c",function(){return i}),a.d(t,"b",function(){return o}),a.d(t,"d",function(){return s});var r=a("t3Un");function n(e){return r.a.post("/tags",{name:e})}function i(){return r.a.get("/tags")}function o(e){return r.a.delete("/tags/"+e)}function s(e,t){return r.a.put("/tags/"+e,{name:t})}},iOob:function(e,t,a){},qVIc:function(e,t,a){"use strict";a.r(t);var r=a("QbLZ"),n=a.n(r),i=a("14Xm"),o=a.n(i),s=a("D3Ub"),l=a.n(s),c=a("jndo"),u={props:{initialValue:{type:String,default:""}},name:"Editorbar",components:{MarkDown:a.n(c).a},methods:{save:function(e){this.$emit("onEditorChange",e)}}},d=a("KHd+"),g=Object(d.a)(u,function(){var e=this.$createElement;return(this._self._c||e)("mark-down",{attrs:{autoSave:!0,initialValue:this.initialValue,interval:1e3},on:{"on-save":this.save}})},[],!1,null,null,null);g.options.__file="editor.vue";var p=g.exports,f=a("gCAA"),m=a("JCNI"),h=a("Ztr3"),v="";localStorage.getItem("token")&&(v="Bearer "+localStorage.getItem("token"));var b={name:"CreateAndUpdate",data:function(){return{tags:[],listLoading:!1,createLoading:!1,saveDraftsLoading:!1,uploadUrl:"http://120.77.219.106:7001/img/upload",uploadHeaders:{authorization:v},fileList:[],articleContent:{title:"",content:{},selectedTagValue:"",date:"",category:""},STATIC_DOMAIN:"http://120.77.219.106:7001",rules:{title:[{type:"string",required:!0,message:"请输入标题",trigger:"blur"}],selectedTagValue:[{type:"string",required:!0,message:"请选择标签",trigger:"blur"}],date:[{type:"date",required:!0,message:"请选择日期",trigger:"blur"}],category:[{type:"string",required:!0,message:"请选择标签",trigger:"blur"}]},getArticleDetailLoading:!1,deleteArticleLoading:!1,categories:[],getCategoriesLoading:!1}},computed:{markdownValue:function(){return this.articleContent.content?this.articleContent.content.markdownValue:""}},mounted:function(){this.$route.query.id&&this.getArticleDetail(this.$route.query.id),this.getList(),this.getCategories()},methods:{onEditorChange:function(e){this.articleContent.content=e},getCategories:function(){var e=this;return l()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.getCategoriesLoading=!0,t.prev=1,t.next=4,Object(h.c)();case 4:a=t.sent,e.getCategoriesLoading=!1,a.data.code?e.$message.error("获取分类失败"):e.categories=a.data.data,t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),e.getCategoriesLoading=!1,e.$message.error("出错了");case 13:case"end":return t.stop()}},t,e,[[1,9]])}))()},getArticleDetail:function(e){var t=this;return l()(o.a.mark(function a(){var r,i,s,l,c,u,d,g;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.getArticleDetailLoading=!0,a.prev=1,a.next=4,Object(m.d)(e);case 4:r=a.sent,t.getArticleDetailLoading=!1,r.data.code?t.$message.error("出错了"):(i=n()({},r.data.data),s=i.title,l=i.publishAt,c=i.markdownValue,u=i.htmlValue,d=i.tag,g=i.category,t.articleContent={title:s,date:new Date(l),content:{markdownValue:c,htmlValue:u},selectedTagValue:d._id,category:g._id}),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),t.getArticleDetailLoading=!1,t.$message.error("出错了");case 13:case"end":return a.stop()}},a,t,[[1,9]])}))()},getList:function(){var e=this;return l()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.prev=1,t.next=4,Object(f.c)();case 4:a=t.sent,e.listLoading=!1,a.data.code?e.$message.error("获取列表失败"):e.tags=a.data.data,t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),e.listLoading=!1,e.$message.error("出错了");case 13:case"end":return t.stop()}},t,e,[[1,9]])}))()},deleteArticle:function(e){var t=this;this.$confirm("确定删除吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:function(){var a=l()(o.a.mark(function a(r,n){var i;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("confirm"!==r){a.next=14;break}return t.deleteArticleLoading=!0,a.prev=2,a.next=5,Object(m.b)(e);case 5:i=a.sent,t.deleteArticleLoading=!1,i.data.code?t.$message.error("删除失败"):(t.$message.success("删除成功"),t.$router.push({path:"/article/list"})),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(2),t.deleteArticleLoading=!1,t.$message.error("出错了");case 14:case"end":return a.stop()}},a,t,[[2,10]])}));return function(e,t){return a.apply(this,arguments)}}()})},publish:function(){var e=this;return l()(o.a.mark(function t(){var a,r,n,i,s,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=e.articleContent,r=a.title,n=a.content,i=a.selectedTagValue,s=a.date,c=a.category,e.$refs.ruleForm.validate(function(){var t=l()(o.a.mark(function t(a){var l;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=23;break}if(e.createLoading=!0,t.prev=2,l=null,!e.$route.query.id){t.next=10;break}return t.next=7,Object(m.e)(e.$route.query.id,{title:r,tag:i,markdownValue:n.markdownValue?n.markdownValue:"",htmlValue:n.htmlValue?n.htmlValue:"",publishAt:Date.parse(s),publishStatus:"2",category:c});case 7:l=t.sent,t.next=13;break;case 10:return t.next=12,Object(m.a)({title:r,tag:i,markdownValue:n.markdownValue?n.markdownValue:"",htmlValue:n.htmlValue?n.htmlValue:"",publishAt:Date.parse(s),publishStatus:"2",category:c});case 12:l=t.sent;case 13:e.createLoading=!1,l.data.code?e.$message.error("发布失败"):e.$message.success("发布成功"),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(2),e.createLoading=!1,e.$message.error("发布失败");case 21:t.next=24;break;case 23:return t.abrupt("return",!1);case 24:case"end":return t.stop()}},t,e,[[2,17]])}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,e)}))()},saveDrafts:function(){var e=this;return l()(o.a.mark(function t(){var a,r,n,i,s,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=e.articleContent,r=a.title,n=a.content,i=a.selectedTagValue,s=a.date,c=a.category,e.$refs.ruleForm.validate(function(){var t=l()(o.a.mark(function t(a){var l;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=23;break}if(e.saveDraftsLoading=!0,t.prev=2,l=null,!e.$route.query.id){t.next=10;break}return t.next=7,Object(m.e)(e.$route.query.id,{title:r,tag:i,markdownValue:n.markdownValue?n.markdownValue:"",htmlValue:n.htmlValue?n.htmlValue:"",publishAt:Date.parse(s),publishStatus:"1",category:c});case 7:l=t.sent,t.next=13;break;case 10:return t.next=12,Object(m.a)({title:r,tag:i,markdownValue:n.markdownValue?n.markdownValue:"",htmlValue:n.htmlValue?n.htmlValue:"",publishAt:Date.parse(s),publishStatus:"1",category:c});case 12:l=t.sent;case 13:e.saveDraftsLoading=!1,l.data.code?e.$message.error("发布失败"):e.$message.success("发布成功"),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(2),e.saveDraftsLoading=!1,e.$message.error("保存失败");case 21:t.next=24;break;case 23:return t.abrupt("return",!1);case 24:case"end":return t.stop()}},t,e,[[2,17]])}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,e)}))()},upLoadSuccess:function(e,t,a){var r=this;e.code?this.$message.error("上传失败"):(this.$message.success("上传成功"),this.fileList=this.fileList.concat(e.data.files.ops.map(function(e,t){return e.url=r.STATIC_DOMAIN+e.url,e})))},upLoadError:function(e,t,a){this.$message.error("上传失败")}},components:{Editor:p}},k=(a("Aa6a"),Object(d.a)(b,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"create-container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.articleContent,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"title",label:"文章标题"}},[a("el-input",{model:{value:e.articleContent.title,callback:function(t){e.$set(e.articleContent,"title",t)},expression:"articleContent.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分类",prop:"category"}},[a("el-select",{attrs:{loading:e.getCategoriesLoading,placeholder:"请选择"},model:{value:e.articleContent.category,callback:function(t){e.$set(e.articleContent,"category",t)},expression:"articleContent.category"}},e._l(e.categories,function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"标签",prop:"selectedTagValue"}},[a("el-select",{attrs:{loading:e.listLoading,placeholder:"请选择"},model:{value:e.articleContent.selectedTagValue,callback:function(t){e.$set(e.articleContent,"selectedTagValue",t)},expression:"articleContent.selectedTagValue"}},e._l(e.tags,function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"date",label:"日期"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.articleContent.date,callback:function(t){e.$set(e.articleContent,"date",t)},expression:"articleContent.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传图片"}},[a("el-upload",{attrs:{headers:e.uploadHeaders,action:e.uploadUrl,multiple:!1,"file-list":e.fileList,"on-success":e.upLoadSuccess,"on-error":e.upLoadError,"show-file-list":!1}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),e.fileList.length>0?a("ul",e._l(e.fileList,function(t){return a("li",{key:{file:t}},[e._v("\n                    "+e._s(t.name)+": "+e._s(t.url)+"\n                ")])})):e._e()],1),e._v(" "),a("el-form-item",[a("Editor",{attrs:{initialValue:e.markdownValue},on:{onEditorChange:e.onEditorChange}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{loading:e.createLoading,type:"primary"},on:{click:e.publish}},[e._v("发布文章")]),e._v(" "),a("el-button",{attrs:{loading:e.saveDraftsLoading},on:{click:e.saveDrafts}},[e._v("存为草稿")]),e._v(" "),e.$route.query.id?a("el-button",{attrs:{loading:e.deleteArticleLoading,type:"danger"},on:{click:function(t){e.deleteArticle(e.$route.query.id)}}},[e._v("删除\n            ")]):e._e()],1)],1)],1)},[],!1,null,"260d334b",null));k.options.__file="createAndUpdate.vue";var w={components:{createAndUpdate:k.exports}},V=Object(d.a)(w,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("createAndUpdate")],1)},[],!1,null,null,null);V.options.__file="create.vue";t.default=V.exports}}]);